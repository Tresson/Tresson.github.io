var keyword_in_context = {
  "Keeps House": {
    "game": [
    "have a pretty decent game if I get myself in trouble",
    "relates to who would start on Game 4 on Monday",
    "going to be one of those games tomrrow where I've got to",
    "wasn't part of the game plan, that's for sure.",
    "They play the game right, good things happen."],

    "pitcher": [
    "He's a talented pitcher.",
    "Most pitchers will give you and let you know where they are",
    "have a left-handed pitcher down that can get right-handers out",
    "You are going to have other starting pitchers.",
    "and an up-ball pitcher and a down-bal pitcher"],

    "baseball": [
    "they're looking for good, solid baseball",
    "the NCAA representative that handles the baseball tournament.",
    "He's a smart baseball player.",
    "a guy that's commanding the baseball and throwing well.",
    "just a tremendous lift to our baseball team all year."],

    "bullpen": [
    "Is he going to stay in the bullpen?",
    "a prominent bullpen guy?",
    "you do need him in the bullpen rather than saying,",
    "No. 1 bullpen stuff, too",
    "they've taken some bullpens, so I have no concerns"],

    "playoff": [
    "home-field advantage side of the playoffs.",
    "Going into the playoffs, did you guys toss around the idea",
    "That's what happens in playoff times, your run into pitchers",
    "and when this playoff time started, we set out to win",
    "In the playoffs it's different"],

    "win": [
    "and you win an emotional game on Friday",
    "doing what I have to do to help the team win.",
    "Not only the first win for the Astros in World Series history",
    "This was a good win for us tonight",
    "and try to win another World Series."],

    "defense": [
    "He is mindful of his defense and his offense",
    "The defense came around as the game went along",
    "put the pressure on defense and throw the ball around",
    "She uses her defense very well",
    "our defense has played really well behind us"],

    "grind": [
    "the physical and mental grind can take its toll during playoffs",
    "to have him at the top of the order and grind pitches",
    "You grind it out the whole entire time",
    "So it had been a grind the two previous innings",
    "you're going to have to grind it out and you're not always"],

    "hitter": [
    "they're a power hitter, a line drive hitter, a contract hitter we",
    "we lost our leadoff hitter with Pagan and we needed some help",
    "he's evolved and developerd as a better hitter as the season",
    "Being a better hitter breeds confidence",
    "maybe throw to some hitters tommorow or whatever",
    "Whether you're a pitcher or you're a hitter, if you're having success"],

    "mound": [
    "starting pitchers and professionals out there on the mound,",
    "all of us, kind of rushed the mound, even though it wasn't our",
    "excited to take the mound tomorrow night with a chance to clinch",
    "how your body's gonna feel until you step out on that mound.",
    "went back on the mound knowning that I had one game under my belt",
    "I'll get off the mound for 10, 15, maybe 20 pitches just to have"],

    "lineup": [],
    "bat": [],
    "fastball": [] },

  "CLUSTER5": {
    "KeepsHouse": [
    "they are going to play and there won't be delays",
    "That's how we play most of the games here.",
    "be able to just play baseball for a couple of hours",
    "ballgame that we play as we move forward",
    "and we get to see them play a lot."],

    "execute": [
    "do our best to execute pitches and hopefully we can",
    "with the bases loaded, we just didn't execute",
    "They execute well, and their pitching staff keeps",
    "you're trying to execute every single pitch on the black",
    "They both executed the bunt,"],

    "bounce": [
    "He knew when to kind of bounce the ball",
    "A bounce back guy, a go-to guy",
    "we were able to bounce back and we caught a break",
    "they would bounce back and came from behind to beat us",
    "and bounce into the Minor Leagues and bounce and watch high school",
    "I can bounce it around"],

    "dominate": [
    "you're not always going to dominate on the mound",
    "he needs to go out and dominate like these two guys",
    "where a team just seems to dominate another",
    "both sides really dominate the media, and I think a lot of times",
    "can pitching continue to dominate this series?",
    "throw strikes and dominate some guys"],

    "envision": [
    "interviews about the role we could envision he could play",
    "what role do you envision him appearing in the division series",
    "he didn't envision any frontline trades as he put it",
    "what scenario would you envision maybe using him?",
    "did you ever envision this being such an offensive dominated series"],

    "draft": [
    "excited about the draft being behind them.",
    "we don't have a first-round draft pick guy",
    "I don't know what draft status they are",
    "it will have to go through a final draft and final approval",
    "college tournaments and be in the draft room",
    "I wasn't even home when the draft started"],

    "amped": [
    "you get amped up and start leaving balls over the middle",
    "go out there and get amped up and pumped up for the game",
    "He looks a little amped up or psycho",
    "I think I was a little amped up",
    "I got a little too amped up in '08",
    "I get more amped up once they get on base."],

    "accomplish": [],
    "bunt": [],
    "pinch": [],
    "embrace": [] },

  "adjective": {
    "close": [
    "close game today.",
    "because when we get in close games, your defense becomes very",
    "I almost threw close to -- I only threw about 32 percent",
    "Being this close, how difficult is it not to press",
    "you are so close to winning a game",
    "as the mound goes, it looks close, for the pitcher's"],

    "tremendous": [
    "he's had and just a tremendous baseball program",
    "played tremendous defense for us.",
    "Done a tremendous job for us.",
    "those guys do a tremendous job of making adjustments.",
    "Tremendous work ethic, gave the bullpen a break each time"],

    "consistent": [
    "this guy has really been so consistent for us all year",
    "he's got more consistent at-bats.",
    "much more consistent the latter-three quarters",
    "I don't think he's consistent in the home run deparment",
    "17 wins, been very consistent all year."],

    "handed": [
    "we're already left-handed heavy.",
    "right now on the right-handed options more than the left",
    "were you ever shorthanded defensively",
    "one of two left-handed pitchers",
    "had all your right-handed platoon guys there"],

    "incredible": [
    "That's an incredible game on so many levels",
    "swings of emotion, incredible key moments in the game",
    "He's an incredible player.",
    "These are two incredible teams that are going to fight",
    "to where we are now, it's incredible.",
    "You guys have an incredible record here"],

    "unbelievable": [
    "He can run the bases, play defense, unbelievable player.",
    "that game and that time, it was just unbelievable.",
    "you realize what an unbelievable thing adrenaline is.",
    "And his stuff is unbelievable, you know.",
    "His work ethic is unbelievable.",
    "The battle that we had last night was unbelievable"],

    "defensive": [
    "He's a tremendous defensive player, and he can get a big hit",
    "You look at a couple defensive plays he made",
    "looking for a better defnsive catcher to work with the young",
    "because of his defensive ability he's not playing anymore?",
    "affect you putting your defnsive squad out there today",
    "whether it's defensive placement or a tweak by the hitting coaches"],

    "awesome": [],
    "phenomenal": [],
    "okay": [],
    "focused": [],
    "unfortuante": [] },

  "interjection": {
    "yeah": [
    "Yeah. I did.",
    "Oh, yeah?",
    "Yeah. He's playing.",
    "he's still got to earn, yeah.",
    "Yeah. we'll see what happens after that"],

    "hey": [
    "we didn't just say, hey -- it wasn't a slam",
    "hey this guy is really beat up",
    "hey I need to go out there and make another start",
    "said, hey -- Yeah, he wants to pitch",
    "she's like, hey just spin it."] } };





function floatingTooltip(tooltipId, width) {
  // Local variable to hold tooltip div for
  // manipulation in other functions.
  var tt = d3.select('body').append('div').
  attr('class', 'tooltip').
  attr('id', tooltipId).
  style('pointer-events', 'none');

  // Set a width if it is provided.
  if (width) {tt.style('width', width);}

  // Initially it is hidden.
  hideTooltip();

  function showTooltip(content, event) {
    // Display tooltip with provided content.
    // content is expected to be HTML string.
    // event is d3.event for positioning.
    tt.style('opacity', 1.0).html(content);
    updatePosition(event);
  }

  function hideTooltip() {
    //  Hide the tooltip div.
    tt.style('opacity', 0.0);
  }

  function updatePosition(event) {
    // Figure out where to place the tooltip
    // based on d3 mouse event.
    var xOffset = 20;
    var yOffset = 10;
    var ttw = tt.style('width');
    var tth = tt.style('height');
    var wscrY = window.scrollY;
    var wscrX = window.scrollX;

    var curX = document.all ?
    event.clientX + wscrX :
    event.pageX;
    var curY = document.all ?
    event.clientY + wscrY :
    event.pageY;
    var ttleft = curX - wscrX + xOffset * 2 + ttw > window.innerWidth ?
    curX - ttw - xOffset * 2 :
    curX + xOffset;

    if (ttleft < wscrX + xOffset) {
      ttleft = wscrX + xOffset;
    }

    var tttop = curY - wscrY + yOffset * 2 + tth > window.innerHeight ?
    curY - tth - yOffset * 2 :
    curY + yOffset;

    if (tttop < wscrY + yOffset) {
      tttop = curY + yOffset;
    }

    tt.style('top', tttop + 'px').style('left', ttleft + 'px');
  }

  return { showTooltip: showTooltip,
    hideTooltip: hideTooltip,
    updatePosition: updatePosition };
}


const POS_GLOSSARY = {

  'ADJ': 'adjective',
  'ADP': 'adposition',
  'ADV': 'adverb',
  'AUX': 'auxiliary',
  'CONJ': 'conjunction',
  'CCONJ': 'coordinating conjunction',
  'DET': 'determiner',
  'INTJ': 'interjection',
  'NOUN': 'noun',
  'NUM': 'numeral',
  'PART': 'particle',
  'PRON': 'pronoun',
  'PROPN': 'proper noun',
  'PUNCT': 'punctuation',
  'SCONJ': 'subordinating conjunction',
  'SYM': 'symbol',
  'CLS': 'cluster1',
  'X': 'other',
  'EOL': 'end of line',
  'SPACE': 'space' };


const WORD_DATA_FILE = 'data/mlb.csv';
const KEYWORD_DATA_FILE = keyword_in_context;
var PARTS_OF_SPEECH = ['CLUSTER1', 'CLUSTER2', 'CLUSTER3', 'CLUSTER4', 'CLUSTER5'];

// const FC_BLUE = '#000'; // CLUSTER1
// const FC_RED = '#000'; // CLUSTER2
// const FC_GREEN = '#000'; // CLUSTER3
// const FC_BROWN = '#000'; // CLUSTER4
// const FC_BLACK = '#000'; // CLUSTER5
// const FC_YELLOW = '#000'; 


const FC_BLUE = '#255e91'; // CLUSTER1
const FC_RED = '#9a514a'; // CLUSTER2
const FC_GREEN = '#1e413d'; // CLUSTER3
const FC_BROWN = '#ac9762'; // CLUSTER4
const FC_BLACK = '#272c31'; // CLUSTER5
const FC_YELLOW = '#d19827'; 

const FC_GRAY = '#F3F3F3';

var COLUMN_NAMES = [];
var KEYWORDS = [];
var KEYWORD_CONTEXT = {};


function get_initial_positions(width, height, font_size = 20, padding = 0, titles = []) {
  let end = width - padding;
  let bucket_size = (end - padding) / titles.length; // 1 bucket per title
  let title_bucket_size = width / titles.length; // ignore padding
  let cluster_centers = {};
  let title_centers = {};
  titles.forEach((title, idx) => {
    let center = padding + (bucket_size * (idx + 1) - bucket_size / 2);
    cluster_centers[title] = { 'x': center, 'y': height / 2 };

    let title_center = title_bucket_size * (idx + 1) - title_bucket_size / 2;
    title_centers[title] = title_center - title.length * font_size / 2;
  });
  return { cluster_centers: cluster_centers, title_centers: title_centers };
}


function normalize_string(txt) {
  // remove duplicate spaces and strip trailing and leading spaces
  txt = txt + ''; // make sure we are dealing with text
  return txt.replace(/\s\s+/g, ' ').replace(/^\s+|\s+$/g, '');
}


function boldRegexMatch(word, string) {
  // add bold tags around all occurances of the matching :word:
  // e.g. word => <b>word</b>
  regex = new RegExp('(^|\\s)(' + word + ')(\\s|$)', 'ig');
  return string.replace(regex, '$1<b>$2</b>$3');
}


function gravity_trim(txt, word, max_length) {


  if (txt.length <= max_length) {
    return txt;
  } else if (txt.indexOf(word) == -1) {
    return txt.substr(0, max_length);
  } else {
    while (txt.length > max_length) {
      let words = txt.split(' ');
      if (words.length === 1) {return words.join(' ');} else
      if (words[words.length - 1] === word) {
        words.shift();
      } else {
        words.pop();
      }
      txt = words.join(' ');
    }
  }
  return txt;
}

function bubbleChart(width=1000, height = 1000, forceStrength = 0.06) {

// function bubbleChart(forceStrength = 0.06) {
  var svg = null,
  bubbles = null,
  nodes = [],
  tooltip = floatingTooltip('genome_tooltip', 240),
  position = get_initial_positions(width, height, 12, 200, PARTS_OF_SPEECH),
  posCenters = position['cluster_centers'],
  posTitleX = position['title_centers'],
  posTitles = d3.keys(posTitleX),
  center = { x: width/2 , y: height/2 };


  function charge(d) {
    return -Math.pow(d.radius, 2.0) * forceStrength;
  }

  var simulation = d3.forceSimulation().
  velocityDecay(.2).
  force('x', d3.forceX().strength(forceStrength).x(center.x)).
  force('y', d3.forceY().strength(forceStrength).y(center.y)).
  force('charge', d3.forceManyBody().strength(charge)).
  on('tick', ticked);

  simulation.stop();

  var fillColor = d3.scaleOrdinal().
  domain(PARTS_OF_SPEECH).
  range([FC_BLUE, FC_BROWN, FC_GREEN, FC_BLACK, FC_RED]);

  function keyword_boost(d, maxSize, amount = 0) {
    // boost the radius of keywords
    let freq = +d.freq;
    if (d.is_keyword == 1 && maxSize * 0.0 > freq) {
      if (freq < maxSize * 0.1) {amount *= 3;}
      if (freq * amount > maxSize) {amount = amount / 1;}
      freq = freq * amount;
    }
    return freq;
  }

  function createNodes(rawData) {
    // Use the max frequency in the data as the max in the scale's domain
    // note we have to ensure the frequency is a number.
    var maxAmount = d3.max(rawData, d => +d.freq);

    // Sizes bubbles based on area.
    // @v4: new flattened scale names.
    var radiusScale = d3.scalePow().
    exponent(0.9).
    range([2, 200]).
    domain([0, maxAmount]);

    // Use map() to convert raw data into node data.
    // Checkout http://learnjsdata.com/ for more on
    // working with data.
    var myNodes = rawData.map(d => {
      let freq = keyword_boost(d, maxAmount, 2);
      return {
        id: d.id,
        radius: radiusScale(freq),
        freq: freq,
        word: d.word,
        pos: d.pos,
        is_keyword: d.is_keyword,
        rel: d.rel,
        lit: d.lit,
        child: d.child,
        x: Math.random() * 900,
        y: Math.random() * 800 };

    });

    // sort them to prevent occlusion of smaller nodes.
    myNodes.sort((a, b) => {return b.freq - a.freq;});
    myNodes.showAmount = Math.round(maxAmount * 0.8);
    return myNodes;
  }

  function getFillColor(d) {
    if (d.is_keyword == 1) {
      return d3.rgb(FC_YELLOW);
    }
    return d3.rgb(fillColor(d.pos));
  }

  function bound_bubble(coord, max_size) {
    // keep bubble in the bounds of the svg element
    return Math.max(Math.min(coord, max_size), 0);
  }

  function ticked() {
    // Callback function that is called after every tick of the force
    // simulation. Here we do the acutal repositioning of the SVG circles
    // based on the current x and y values of their bound node data.
    // These x and y values are modified by the force simulation.
    bubbles.
    attr('cx', d => bound_bubble(d.x, width)).
    attr('cy', d => bound_bubble(d.y, height));
  }

  function nodePosPosition(d) {
    // provide X value for each node, to be used w/ split by POS
    return posCenters[d.pos].x;
  }

  function groupBubbles() {
    // Sets visualization in "single group mode". The POS labels are hidden
    // and the force layout tick function is set to move all nodes to the
    // center of the visualization.
    hidePosTitles();

    // @v4 Reset the 'x' force to draw the bubbles to the center.
    simulation.force('x', d3.forceX().strength(forceStrength).x(center.x));

    // @v4 We can reset the alpha value and restart the simulation
    simulation.alpha(1).restart();
  }

  function splitBubbles() {
    // Sets visualization in "split by POS mode". The POS labels are showing
    // and the force layout tick function is set to move nodes to the center
    // of the POS's cluster.
    showPosTitles();
    showPosInfo();

    // @v4 Reset the 'x' force to draw the bubbles to their year centers
    simulation.force('x', d3.forceX().strength(forceStrength).x(nodePosPosition));

    // @v4 We can reset the alpha value and restart the simulation
    simulation.alpha(1).restart();
  }
  ////////////////////////////////////////////////////////////////////

  function hidePosTitles() {
    // Hides POS title displays.
    svg.selectAll('.pos_title').remove();
    hidePosInfo();
  }

  function show_legend(items, iwidth = 0, iheight = 0, items_per_row = 2) {
    if (items.indexOf('KEYWORDS') == -1) {items.push('KEYWORDS');}

    let x_spacing = 120;
    let row_count = items.length > items_per_row ?
    items.length / items_per_row :
    items.length;

    var legend = svg.append('g').
    attr('class', 'legend').
    attr('x', 0).
    attr('y', 0).
    attr('height', iheight).
    attr('width', iwidth);

    legend.selectAll('rect').data(items).enter().
    append('rect').
    attr('class', 'legend-rect').
    attr('x', (d, i) => i * x_spacing).
    attr('y', 10).
    attr('width', 10).
    attr('height', 10).
    style('fill', d => d == 'KEYWORDS' ? FC_YELLOW : d3.rgb(fillColor(d)));

    legend.selectAll('text').data(items).enter().
    append('text').
    attr('class', 'legend-text').
    attr('x', (d, i) => i * x_spacing + 20).
    attr('y', 20).
    attr('text-anchor', 'start').
    text(d => d);

    return legend;
  }

  ////////////////////////////////////////////////////////////////////

  function showPosTitles() {
  
    // var parts_of_speech = svg.selectAll('.pos').data(posTitles);
    // show_legend(posTitles);

    // parts_of_speech.enter().append('text')
    //     .attr('class', 'pos')
    //     .attr('x', d => posTitleX[d])
    //     .attr('y', height * 0.1)
    //     .attr('text-anchor', 'middle')
    //     .text(d => d);
  }

  function clickBubble(d) {
    d3.select(this).
    attr('stroke', '#d19827').
    attr('stroke-width', 1).
    attr('fill', d => getFillColor(d).darker());


    if (d.is_keyword == '1') {
      console.log('do something with KEYWORD:', d.word);
    } else {
      console.log('do something with:', d.word);
    }
  }

  function showDetail(d) {
    // Function called on mouseover to display the
    // details of a bubble in the tooltip.
    // change outline to indicate hover state.
    d3.select(this).attr('stroke', '#d19827');
    d3.select(`#${d.pos}-${d.word}`).
    style('color', FC_YELLOW).
    style('font-weight', 'bold');

    var content = `
            <span class="tooltip-field-name">Representation: </span>
            <span class="tooltip-field-value">${d.freq}</span>
             <br />
            <span class="tooltip-field-name">Occupation: </span>
            <span class="tooltip-field-value">${d.word}</span>
            <br />
            <span class="tooltip-field-name">Literacy: </span>
            <span class="tooltip-field-value">${d.lit}</span>
             <br />
            <span class="tooltip-field-name">Relationship to Head of Household: </span>
            <span class="tooltip-field-value">${d.rel}</span>
             <br />
            <span class="tooltip-field-name">Has Children: </span>
            <span class="tooltip-field-value">${d.child}</span>
             <br />
            <span class="tooltip-field-name">Cluster: </span>
            <span class="tooltip-field-value">${d.pos}</span>
        `;

    // if the input is a keyword and it has an entry in the
    // keyword-in-context file then we want to extract the example
    // sentences and add them to the tooltip popup as an unordered list.
    if (d.is_keyword == '1') {
      let lis = KEYWORD_CONTEXT[d.pos.toLowerCase()] || {};
      let examples = lis[d.word] || [];
      examples = examples.map(x => gravity_trim(x, d.word, 48));
      if (examples.length > 0) {
        lines = '<li>' + examples.join('</li><li>') + '</li>';
        lines = boldRegexMatch(d.word, lines);
        content += `
                    <br /><br />
                    <span class="tooltip-field-name">Examples in Context: </span>
                    <ul class="keyword-in-context">${lines}</ul>
                `;
      }
    }

    tooltip.showTooltip(content, d3.event);
  }

  function hideDetail(d) {
    // Hides tooltip and resets the bubble to its original colors
    d3.select(`#${d.pos}-${d.word}`).
    style('color', '#000').
    style('font-weight', 'normal');

    d3.select(this).
    transition().
    duration(300).
    attr('fill', getFillColor(d)).
    attr('stroke', getFillColor(d).darker()).
    attr('stroke-width', 1);

    tooltip.hideTooltip();
  }


  function showPosInfo(d) {
    
    let ldata = {};
    let titles = posTitles.filter(title => title != 'KEYWORDS');
    titles.forEach(pos => {
      ldata[pos] = KEYWORDS.filter(
      d => d.pos == pos).sort((a, b) => b.freq - a.freq);
    });

    
    let uls = d3.select('.viz-details').selectAll('ul').data(titles).
    // enter().append('ul').
    attr('class', 'keywords').
    attr('data-index', (d, i) => i).
    attr('id', d => `ul-${d}-keyword`).
    call(parent => {
      parent._groups[0].forEach(group => {
        let ul = d3.select(group);
        ul.append('h3').html(group.__data__);
        ul.selectAll('li').data(ldata[group.__data__]).enter().
        append('li').
        attr('id', d => d.pos + '-' + d.word).
        attr('class', 'keyword-li').
        html(d => d.word);
      });
    });
  }

  function hidePosInfo(d) {
    d3.selectAll('.keywords').remove();
  }

  var chart = function chart(selector, rawData, col_names = null) {
    nodes = createNodes(rawData);

    // Create a SVG element inside the provided selector
    // with desired size.
    svg = d3.select(selector).
    append('svg').
    attr('width', width).
    attr('height', height);

    // Bind nodes data to what will become DOM elements to represent them.
    bubbles = svg.selectAll('.bubble').data(nodes, d => d.id);

    // Create new circle elements each with class `bubble`.
    // There will be one circle.bubble for each object in the nodes array.
    // Initially, their radius (r attribute) will be 0.
    var bubblesE = bubbles.enter().append('circle').
    classed('bubble', true).
    attr('r', 0).
    attr('fill', d => getFillColor(d)).
    attr('stroke', d => d.is_keyword == 1 ? '#f3f3f3' : getFillColor(d).darker()).
    attr('stroke-width', 1)
    // .text(d => d.freq > nodes.showAmount ? d.word : '')
    .on('mouseover', showDetail).
    on('mouseout', hideDetail).
    on('click', clickBubble);

    // @v4 Merge the original empty selection and the enter selection
    bubbles = bubbles.merge(bubblesE);

    // Fancy transition to make bubbles appear, ending with the
    // correct radius
    bubbles.transition().
    duration(2000).
    attr('r', d => d.radius);

    // Set the simulation's nodes to our newly created nodes array.
    // @v4 Once we set the nodes, the simulation will start running!
    simulation.nodes(nodes);
    groupBubbles(); // start layout in single POS position
  };

  chart.toggleDisplay = function (displayName) {
    // Externally accessible function (this is attached to the
    // returned chart function). Allows the visualization to toggle
    // between "single pos" and "split pos" modes.
    // displayName is expected to be a string and either 'words' or 'all'.
    if (displayName === 'pos') {
      splitBubbles();
    } else {
      groupBubbles();
    }
  };

  // return the chart function from closure.
  return chart;
}


// Below is the initialization code as well as some helper functions
// to create a new bubble chart instance, load the data, and display it.
var myBubbleChart = bubbleChart();


function display(error, data) {
  // Function called once data is loaded from CSV.
  // Calls bubble chart function to display inside #vis div.
  if (error) {console.error(error);}

  KEYWORD_CONTEXT = keyword_in_context;
  COLUMN_NAMES = Object.keys(data[0]);
  KEYWORDS = data.filter(d => d.is_keyword == 1);
  // let fields = [...new Set(KEYWORDS.map(row => row.pos))]
  myBubbleChart('#vis', data, COLUMN_NAMES);
}

function setupButtons() {
  // Sets up the layout buttons to allow for toggling between view modes.
  d3.select('#toolbar').
  selectAll('.button').
  on('click', function () {
    // Remove active class from all buttons
    d3.event.preventDefault();
    d3.selectAll('.button').classed('active', false);
    let button = d3.select(this); // find clicked btn
    button.classed('active', true); // set btn to active
    let buttonId = button.attr('id'); // get btn id
    myBubbleChart.toggleDisplay(buttonId); // toggle chart
  });
}

d3.csv(WORD_DATA_FILE, display);


setupButtons();